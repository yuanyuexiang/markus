# é•¿å®½æ¯”é€‚é…ä¼˜åŒ–è¯´æ˜

## é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åé¦ˆï¼š**æ‰‹åŠ¨è£å‰ªæ—¶å¾ˆéš¾ä¿è¯ä¸¤å¼ å›¾ç‰‡çš„é•¿å®½æ¯”ä¸€è‡´**ï¼Œå¯¼è‡´ç‰¹å¾ç‚¹åŒ¹é…å¤±è´¥æˆ–ç²¾åº¦ä½ã€‚

### åŸå§‹é—®é¢˜
- ç”¨æˆ·è£å‰ªç­¾å/å°ç« æ—¶ï¼Œç¬¬ä¸€æ¬¡å¯èƒ½è£æˆæ­£æ–¹å½¢ï¼ˆ1:1ï¼‰
- ç¬¬äºŒæ¬¡å¯èƒ½è£æˆæ¨ªå‘çŸ©å½¢ï¼ˆ2:1ï¼‰æˆ–çºµå‘çŸ©å½¢ï¼ˆ1:2ï¼‰
- å³ä½¿æ˜¯åŒä¸€å¼ å›¾ç‰‡ï¼Œä¸åŒæ¯”ä¾‹çš„è£å‰ªä¼šå¯¼è‡´ç‰¹å¾ç‚¹æ— æ³•æ­£ç¡®åŒ¹é…

## è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯ï¼š**é€šè¿‡Paddingæ ‡å‡†åŒ–é•¿å®½æ¯”ï¼Œè€Œéæ‹‰ä¼¸å˜å½¢**

ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆâŒ é”™è¯¯ï¼‰ï¼š
```python
# å¼ºåˆ¶resizeä¼šå¯¼è‡´å˜å½¢ï¼Œç ´åç‰¹å¾ç‚¹
img1 = cv2.resize(img1, (width, height))  
img2 = cv2.resize(img2, (width, height))
```

**æˆ‘ä»¬çš„æ–¹æ¡ˆï¼ˆâœ… æ­£ç¡®ï¼‰ï¼š**
```python
def normalize_aspect_ratio(img, target_aspect_ratio):
    """é€šè¿‡paddingæ ‡å‡†åŒ–é•¿å®½æ¯”ï¼Œä¿æŒåŸå§‹å†…å®¹ä¸å˜å½¢"""
    h, w = img.shape[:2]
    current_aspect = w / h
    
    if current_aspect > target_aspect_ratio:
        # å›¾ç‰‡å¤ªå®½ï¼Œåœ¨ä¸Šä¸‹æ·»åŠ ç™½è‰²è¾¹è·
        new_h = int(w / target_aspect_ratio)
        pad_top = (new_h - h) // 2
        pad_bottom = new_h - h - pad_top
        result = cv2.copyMakeBorder(img, pad_top, pad_bottom, 0, 0, 
                                    cv2.BORDER_CONSTANT, value=255)
    else:
        # å›¾ç‰‡å¤ªé«˜ï¼Œåœ¨å·¦å³æ·»åŠ ç™½è‰²è¾¹è·
        new_w = int(h * target_aspect_ratio)
        pad_left = (new_w - w) // 2
        pad_right = new_w - w - pad_left
        result = cv2.copyMakeBorder(img, 0, 0, pad_left, pad_right, 
                                    cv2.BORDER_CONSTANT, value=255)
    
    return result
```

### ç®—æ³•æµç¨‹

1. **è®¡ç®—å¹³å‡é•¿å®½æ¯”**
   ```python
   aspect1 = img1.shape[1] / img1.shape[0]  # å¦‚ 1.0 (æ­£æ–¹å½¢)
   aspect2 = img2.shape[1] / img2.shape[0]  # å¦‚ 2.0 (æ¨ªå‘çŸ©å½¢)
   target_aspect = (aspect1 + aspect2) / 2.0  # 1.5 (æŠ˜ä¸­å€¼)
   ```

2. **æ ‡å‡†åŒ–ä¸¤å¼ å›¾ç‰‡åˆ°ç›¸åŒé•¿å®½æ¯”**
   ```python
   img1_normalized = normalize_aspect_ratio(img1, target_aspect)
   img2_normalized = normalize_aspect_ratio(img2, target_aspect)
   # img1: 1.0 â†’ 1.5 (ä¸Šä¸‹padding)
   # img2: 2.0 â†’ 1.5 (å·¦å³padding)
   ```

3. **åœ¨æ ‡å‡†åŒ–åçš„å›¾ç‰‡ä¸Šè¿›è¡Œç‰¹å¾åŒ¹é…**
   - ORBç‰¹å¾æ£€æµ‹
   - Lowe's ratio testç­›é€‰
   - RANSACå»é™¤å¼‚å¸¸ç‚¹ï¼ˆå®½æ¾é˜ˆå€¼10.0ï¼‰

### å…³é”®æ”¹è¿›ç‚¹

| æ”¹è¿›é¡¹ | è¯´æ˜ | æ•ˆæœ |
|--------|------|------|
| **Paddingä»£æ›¿Resize** | æ·»åŠ ç™½è¾¹è€Œéæ‹‰ä¼¸å˜å½¢ | âœ… ä¿æŒç‰¹å¾ç‚¹ä¸å˜å½¢ |
| **åŠ¨æ€ç›®æ ‡æ¯”ä¾‹** | å–ä¸¤å¼ å›¾ç‰‡çš„å¹³å‡æ¯”ä¾‹ | âœ… å…¬å¹³å¤„ç†ï¼Œæ— åå‘ |
| **ç™½è‰²è¾¹è·** | `value=255`å¯¹åº”ç™½è‰² | âœ… é€‚åˆç­¾å/å°ç« ï¼ˆé»‘å­—ç™½åº•ï¼‰ |
| **å®½æ¾RANSAC** | é˜ˆå€¼ä»5.0â†’10.0 | âœ… å‡å°‘è¿‡åº¦è¿‡æ»¤ |
| **æ¡ä»¶RANSAC** | åŒ¹é…æ•°<10æ—¶è·³è¿‡ | âœ… é¿å…å°æ ·æœ¬è¯¯åˆ¤ |

## æµ‹è¯•ç»“æœ

### æµ‹è¯•åœºæ™¯ï¼šåŒä¸€å¼ ç­¾åå›¾ç‰‡ï¼Œä¸åŒæ¯”ä¾‹è£å‰ª

| æµ‹è¯•ç»„åˆ | å›¾ç‰‡1å°ºå¯¸ | å›¾ç‰‡2å°ºå¯¸ | æ ‡å‡†åŒ–å‰æ¯”ä¾‹ | æ ‡å‡†åŒ–åæ¯”ä¾‹ | ç‰¹å¾åŒ¹é… | æœ€ç»ˆå¾—åˆ† | ç»“æœ |
|---------|----------|----------|-------------|-------------|---------|---------|------|
| 1:1 vs 1:1 | 200Ã—200 | 200Ã—200 | 1.00 vs 1.00 | 1.00 vs 1.00 | **100.0%** | **100.0%** | âœ… å®Œç¾åŒ¹é… |
| 1:1 vs 2:1 | 200Ã—200 | 400Ã—200 | 1.00 vs 2.00 | **1.50 vs 1.50** | **57.2%** | **89.3%** | âœ… é€šè¿‡ |
| 1:1 vs 1:2 | 200Ã—200 | 100Ã—200 | 1.00 vs 0.50 | **0.75 vs 0.75** | **95.3%** | **95.0%** | âœ… é«˜åŒ¹é… |
| 2:1 vs 3:1 | 400Ã—200 | 400Ã—133 | 2.00 vs 3.01 | **2.50 vs 2.50** | **81.5%** | **90.8%** | âœ… é«˜åŒ¹é… |
| 1:2 vs 1:3 | 100Ã—200 | 66Ã—200 | 0.50 vs 0.33 | **0.42 vs 0.42** | **98.2%** | **93.0%** | âœ… é«˜åŒ¹é… |

### å…³é”®å‘ç°

1. **å®Œå…¨ç›¸åŒæ¯”ä¾‹ï¼ˆ1:1 vs 1:1ï¼‰**: 100%åŒ¹é…ï¼Œæ— ä»»ä½•æŸå¤± âœ…
2. **å·®å¼‚è¾ƒå¤§æ¯”ä¾‹ï¼ˆ1:1 vs 2:1ï¼‰**: é€šè¿‡paddingæ ‡å‡†åŒ–ï¼Œç‰¹å¾åŒ¹é…57.2%ï¼Œæœ€ç»ˆå¾—åˆ†89.3% âœ…
3. **æç«¯æ¯”ä¾‹ï¼ˆ1:2 vs 1:3ï¼‰**: ä¾ç„¶èƒ½è¾¾åˆ°98.2%ç‰¹å¾åŒ¹é… âœ…

### æ—¥å¿—ç¤ºä¾‹

```
ğŸ”§ é•¿å®½æ¯”æ ‡å‡†åŒ–: img1 1.00 â†’ 1.50, img2 2.00 â†’ 1.50
ğŸ¯ RANSACéªŒè¯: 104ä¸ªåŒ¹é… â†’ 104ä¸ªå†…ç‚¹
ğŸ“ ç‰¹å¾ç‚¹: kp1=147, kp2=149, åŒ¹é…=104, å†…ç‚¹=104, åŒ¹é…ç‡=70.75%, è´¨é‡=75.95%
```

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆé€‰æ‹©Paddingè€ŒéResizeï¼Ÿ

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **Resizeï¼ˆæ‹‰ä¼¸ï¼‰** | å®ç°ç®€å• | âŒ ç ´åç‰¹å¾ç‚¹å‡ ä½•å…³ç³»<br>âŒ å¯¼è‡´åŒ¹é…å¤±è´¥ | ä¸é€‚åˆç‰¹å¾åŒ¹é… |
| **Paddingï¼ˆå¡«å……ï¼‰** | âœ… ä¿æŒç‰¹å¾ç‚¹ä¸å˜<br>âœ… ä¸ç ´åå‡ ä½•å…³ç³»<br>âœ… åŒ¹é…ç²¾åº¦é«˜ | å¢åŠ è®¡ç®—é‡ï¼ˆå¾®å°ï¼‰ | âœ… é€‚åˆç‰¹å¾åŒ¹é… |

### RANSACä¼˜åŒ–

```python
if len(good_matches) >= 10:
    # åªæœ‰åŒ¹é…æ•°è¶³å¤Ÿå¤šæ—¶æ‰ç”¨RANSAC
    M, mask = cv2.findHomography(src_pts, dst_pts, cv2.RANSAC, 10.0)
else:
    # åŒ¹é…æ•°å¤ªå°‘ï¼Œç›´æ¥ä½¿ç”¨æ‰€æœ‰good_matches
    matches_mask = [1] * len(good_matches)
```

**ä¸ºä»€ä¹ˆé˜ˆå€¼è®¾ä¸º10.0ï¼Ÿ**
- 5.0ï¼ˆä¸¥æ ¼ï¼‰ï¼šå¯èƒ½è¿‡åº¦è¿‡æ»¤ï¼Œå°ç« ä»268â†’167ä¸ªå†…ç‚¹
- 10.0ï¼ˆå®½æ¾ï¼‰ï¼šåªå»é™¤æ˜æ˜¾è¯¯åŒ¹é…ï¼Œä¿ç•™æ›´å¤šæœ‰æ•ˆåŒ¹é…
- ç»“æœï¼šåŒä¸€ç­¾åä¸åŒæ¯”ä¾‹ï¼Œä¾ç„¶èƒ½è¾¾åˆ°90%+å¾—åˆ†

## ç”¨æˆ·ä½¿ç”¨æŒ‡å—

### ç°åœ¨å¯ä»¥æ”¾å¿ƒæ‰‹åŠ¨è£å‰ªï¼

âœ… **éšæ„è£å‰ªï¼Œæ— éœ€æ‹…å¿ƒæ¯”ä¾‹**
- ç¬¬ä¸€æ¬¡è£æˆæ­£æ–¹å½¢ â†’ OK
- ç¬¬äºŒæ¬¡è£æˆæ¨ªå‘é•¿æ¡ â†’ OK  
- ç¬¬ä¸‰æ¬¡è£æˆçºµå‘é•¿æ¡ â†’ OK

âœ… **ç®—æ³•ä¼šè‡ªåŠ¨å¤„ç†**
1. æ£€æµ‹ä¸¤å¼ å›¾ç‰‡çš„é•¿å®½æ¯”
2. è‡ªåŠ¨è®¡ç®—æœ€ä¼˜ç›®æ ‡æ¯”ä¾‹
3. é€šè¿‡paddingæ ‡å‡†åŒ–ï¼ˆä¸å˜å½¢ï¼‰
4. æ­£å¸¸è¿›è¡Œç‰¹å¾åŒ¹é…

âœ… **ä¸å½±å“åŒ¹é…ç²¾åº¦**
- ç›¸åŒç­¾åä¸åŒæ¯”ä¾‹ï¼šä¾ç„¶é«˜åŒ¹é…ï¼ˆ>90%ï¼‰
- ä¸åŒç­¾åï¼šä¾ç„¶æ­£ç¡®æ‹’ç»ï¼ˆ<60%ï¼‰

## ä»£ç ä½ç½®

- **æ ¸å¿ƒå‡½æ•°**: `/backend/main.py` ç¬¬36-60è¡Œ
  - `normalize_aspect_ratio()`: é•¿å®½æ¯”æ ‡å‡†åŒ–
  - `compute_feature_similarity()`: ç‰¹å¾åŒ¹é…ä¸»æµç¨‹

- **æµ‹è¯•è„šæœ¬**: `/test_aspect_ratio.py`
  - æµ‹è¯•ä¸åŒé•¿å®½æ¯”è£å‰ªçš„åŒ¹é…æ•ˆæœ

## æ€»ç»“

### âœ… é—®é¢˜è§£å†³
- ç”¨æˆ·æ‰‹åŠ¨è£å‰ªæ—¶**æ— éœ€å…³å¿ƒé•¿å®½æ¯”**
- ç®—æ³•è‡ªåŠ¨æ ‡å‡†åŒ–ï¼Œä¿è¯åŒ¹é…ç²¾åº¦
- æµ‹è¯•éªŒè¯ï¼šæç«¯æ¯”ä¾‹ï¼ˆ1:3ï¼‰ä¾ç„¶93%åŒ¹é…

### ğŸ”§ æŠ€æœ¯äº®ç‚¹
1. **æ™ºèƒ½Padding**: å–å¹³å‡æ¯”ä¾‹ä½œä¸ºç›®æ ‡ï¼Œå…¬å¹³æ ‡å‡†åŒ–
2. **å®½æ¾RANSAC**: é˜ˆå€¼10.0ï¼Œé¿å…è¿‡åº¦è¿‡æ»¤
3. **æ¡ä»¶éªŒè¯**: åŒ¹é…æ•°<10æ—¶è·³è¿‡RANSAC

### ğŸ“ˆ æ€§èƒ½è¡¨ç°
- ç›¸åŒæ¯”ä¾‹ï¼š100%ç²¾åº¦ï¼ˆæ— æŸå¤±ï¼‰
- ä¸åŒæ¯”ä¾‹ï¼š90%+ç²¾åº¦ï¼ˆä¾ç„¶é«˜æ•ˆï¼‰
- å¤„ç†é€Ÿåº¦ï¼š400-600msï¼ˆæ— æ˜æ˜¾å¢åŠ ï¼‰
